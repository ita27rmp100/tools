<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>GitHub Repo PG</title> <!--PG : PreviewGenerator-->
</head>
<body style="overflow-x:hidden">
    <nav class="navbar navbar-light bg-light d-flex row justify-content-around">
        <section class="navbar-brand mb-0 h1" id="title"></section>
    </nav>
    <nav class="form-inline center p-4 d-flex justify-content-center align-items-center w-100" style="flex-direction:column;">
        <div class="w-100 d-flex justify-content-center align-items-center row center" style="flex-direction: column;">
            <div class="input-group mb-3 w-100">
                <input type="text" class="form-control text-center" placeholder="username/repo-name" id="repo-name">
                <div class="input-group-append">
                    <button class="btn btn-success" type="button" onclick="fetchRepoDetails()">Generate</button>
                </div>
            </div>
            <input type="range" value="450" max="600" min="300" id="widthController" class="w-100">
        </div>
            <br>
        <div class="card card-profile shadow-sm mt-3" id="preview" style="width:400px;">
            <div class="card-body">
                <img src="https://github.githubassets.com/assets/GitHub-Mark-ea2971cee799.png" width="15px" height="15px" alt="githubIcon" class="right float-right">
                <div class="d-flex align-items-center mb-3 right">
                    <img src="ita.jpg" width="60px" height="60px" alt="Profile Image" class="profile-image rounded right" id="avatar">
                    <div class="ml-3" id="userrepo">
                        <h4 class="font-weight-bold mb-0 text-muted">
                            ita27rmp100/
                            <br> 
                            <span class="text-dark" id="reponame">PyCSV</span>
                        </h4>
                    </div>
                </div>
                <p class="text-muted" id="desc">This library has nine functions to import the data from CSV files, organize the data that you import...</p>
                <div class="d-flex justify-content-between text-muted">
                    <small><i class="fas fa-user"></i> <b id="cntrb">0</b> Contributor</small>
                    <small><i class="fas fa-exclamation-circle"></i> <b id="issue">0</b> Issues</small>
                    <small><i class="fas fa-star"></i> <b id="star">0</b> Stars</small>
                    <small><i class="fas fa-code-branch"></i> <b id="fork">0</b> Forks</small>
                </div>
            </div>
            <div class="card-footer bg-primary p-1"></div>
        </div>
        <button onclick="downloadPreview()" class="btn btn-success mt-3" id="dp">Download Preview</button>
    </nav>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        $("#preview , #dp").hide()
        $("#title").text(document.title)
        let repoName = ''
        let widthRange= document.getElementById("widthController")
        widthRange.addEventListener('input',()=>{$("#preview").css('width',`${$("#widthController").val()}px`)})
        function fetchRepoDetails(){
            let repo = $("#repo-name").val().replace("https://github.com/",'')
            $.get(`https://api.github.com/repos/${repo}`,function(data){
                repoName = data.name
                $("#userrepo").html(
                    `<h4 class="font-weight-bold mb-0 text-muted">
                            ${data.owner.login}/
                            <br> 
                            <span class="text-dark">${data.name}</span>
                    </h4>`
                )
                $("#avatar").attr({
                    'src': data.owner.avatar_url,
                    'crossorigin': 'anonymous'
                });
                $("#fork").text(data.forks_count);
                $("#star").text(data.stargazers_count);
                $("#issue").text(data.open_issues_count);
                $("#cntrb").text(data.network_count)
                $("#desc").text(data.description.slice(0,100)+"...")
                $("#preview").fadeIn()
            $("#dp").show()
            })
        }
        function downloadPreview() {
            const preview = document.getElementById('preview');     
            html2canvas(preview, {
                useCORS: true,
                allowTaint: false,
                logging: true,
                proxy: "https://cors-anywhere.herokuapp.com/"
            }).then(canvas => {
                const link = document.createElement("a");
                link.download = `${repoName}_preview.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
            }).catch(error => console.error("Error generating the image:", error));
        }


    </script>
</body>
</html>